{% extends 'sv/base.html' %}

{% load static %}

{% block extrahead %}
<link rel="stylesheet" href="{% static 'sv/fichedetection_form.css' %}">

<!-- Alpine Core -->
<script defer src="{% static 'alpineV3.cdn.min.js' %}"></script>
{% endblock %}

{% block scripts %}
<script type="text/javascript" src="{% static 'sv/fichedetection_form.js' %}"></script>
{% endblock %}

{% block content %}
<main x-data="app">
	<div id="fiche-detection-form-header">
		<h1>Création d'une fiche détection</h1>
		<p>
			<input type="submit" value="Enregistrer" class="fr-btn" @click="saveFicheDetection()">
		</p>
	</div>

	<div id="fiche-detection-form" >
			{% csrf_token %}

			<div id="fiche-detection-form-post-url" data-url="{% url 'fiche-detection-creation' %}" ></div>

			{{ departements|json_script:"departements" }}
			{{ unites|json_script:"unites" }}
			{{ statuts_evenement|json_script:"statuts-evenement" }}
			{{ organismes_nuisibles|json_script:"organismes-nuisibles" }}
			{{ statuts_reglementaires|json_script:"statuts-reglementaires" }}
			{{ contextes|json_script:"contextes" }}
			{{ structures_preleveurs|json_script:"structures-preleveurs" }}
			{{ sites_inspections|json_script:"sites-inspections" }}
			{{ matrices_prelevees|json_script:"matrices-prelevees" }}
			{{ especes_echantillon|json_script:"especes-echantillon" }}
			{{ laboratoires_agrees|json_script:"laboratoires-agrees" }}
			{{ laboratoires_confirmation_officielle|json_script:"laboratoires-confirmation-officielle" }}

			<div id="informations">
				<h2>Informations</h2>
				<div id="informations-content">
					<p id="date-creation">
						<label class="fr-label" for="date-creation-input">Date de création</label>
						<input type="text" id="date-creation-input" class="fr-input" value="{% now 'd/m/Y' %}" disabled>
					</p>
					<p id="createur">
						<label class="fr-label">Créateur</label>
						<select x-model="ficheDetection.createurId" id="createur-input" class="fr-select" required>
							<option value="">----</option>
							<template x-for="unite in unites" :key="unite.id">
								<option :value="unite.id" x-text="unite.nom"></option>
							</template>
						</select>
					</p>
					<p id="statut-evenement">
						<label class="fr-label" for="statut-evenement-input">Statut évènement</label>
						<select x-model="ficheDetection.statutEvenementId" id="statut-evenement-input" class="fr-select">
							<option value="">----</option>
							<template x-for="statutEvenement in statutsEvenement" :key="statutEvenement.id">
								<option :value="statutEvenement.id" x-text="statutEvenement.libelle"></option>
							</template>
						</select>
					</p>
				</div>
			</div>

			<div id="objet-evenement">
				<h2>Objet de l'évènement</h2>
				<p id="organisme-nuisible">
					<label class="fr-label" for="organisme-nuisible-input">Organisme nuisible</label>
					<select x-model="ficheDetection.organismeNuisibleId" id="organisme-nuisible-input" class="fr-select">
						<option value="">----</option>
						<template x-for="organismeNuisible in organismesNuisibles" :key="organismeNuisible.id">
							<option :value="organismeNuisible.id" x-text="organismeNuisible.libelle_court"></option>
						</template>
					</select>
				</p>
				<p id="statut-reglementaire">
					<label class="fr-label" for="statut-reglementaire-input">Statut règlementaire</label>
					<select x-model="ficheDetection.statutReglementaireId" id="statut-reglementaire-input" class="fr-select">
						<option value="">----</option>
						<template x-for="statutReglementaire in statutsReglementaires" :key="statutReglementaire.id">
							<option :value="statutReglementaire.id" x-text="statutReglementaire.libelle"></option>
						</template>
					</select>
				</p>
				<p id="contexte">
					<label class="fr-label" for="contexte-input">Contexte</label>
					<select x-model="ficheDetection.contexteId" id="contexte-input" class="fr-select">
						<option value="">----</option>
						<template x-for="contexte in contextes" :key="contexte.id">
							<option :value="contexte.id" x-text="contexte.nom"></option>
						</template>
					</select>
				</p>
				<p id="date-1er-signalement">
					<label class="fr-label" for="date-1er-signalement-input">Date 1er signalement</label>
					<input x-model="ficheDetection.datePremierSignalement" type="date" id="date-1er-signalement-input" class="fr-input">
				</p>
				<p>
					<label class="fr-label" for="commentaire-input">Commentaire</label>
					<textarea x-model="ficheDetection.commentaire" id="commentaire-input" class="fr-input"></textarea>
				</p>
			</div>

			<div id="localisations">
				<div id="localisations-header">
					<h2>Lieux</h2>
					<button class="fr-btn fr-btn--secondary fr-btn--icon-left fr-icon-add-line" data-fr-opened="false" aria-controls="modal-add-edit-localisation">Ajouter une localisation</button>
				</div>
				{% include 'sv/_fichedetection_form__localisations.html' %}
			</div>

			<div id="prelevements">
				<div id="prelevements-header">
					<h2>Prélèvements</h2>
					<template x-if="localisations.length > 0">
						<button @click="addPrelevementForm()" class="fr-btn fr-btn--secondary fr-btn--icon-left fr-icon-add-line" data-fr-opened="false" aria-controls="modal-add-edit-prelevement">Ajouter un prélèvement</button>
					</template>
				</div>
				{% include 'sv/_fichedetection_form__prelevements.html' %}
			</div>

			<div id="mesures-gestion">
				<h2>Mesures de gestion</h2>
				<div id="mesures-gestion-content">
					<p id="mesures-conservatoires-immediates">
						<label class="fr-label" for="mesures-conservatoires-immediates-input">Mesures conservatoires immédiates</label>
						<textarea x-model="ficheDetection.mesuresConservatoiresImmediates" id="mesures-conservatoires-immediates-input" class="fr-input"></textarea>
					</p>
					<p id="mesures-consignation">
						<label class="fr-label" for="mesures-consignation-input">Mesures de consignation</label>
						<textarea x-model="ficheDetection.mesuresConsignation" id="mesures-consignation-input" class="fr-input"></textarea>
					</p>
					<p id="mesures-phytosanitaires">
						<label class="fr-label" for="mesures-phytosanitaires-input">Mesures phytosanitaires</label>
						<textarea x-model="ficheDetection.mesuresPhytosanitaires" id="mesures-phytosanitaires-input" class="fr-input"></textarea>
					</p>
					<p id="mesures-surveillance-specifique">
						<label class="fr-label" for="mesures-surveillance-specifique-input">Mesures de surveillance spécifique</label>
						<textarea x-model="ficheDetection.mesuresSurveillanceSpecifique" id="mesures-surveillance-specifique-input" class="fr-input"></textarea>
					</p>
				</div>
			</div>
	</div>
</main>
{% endblock %}