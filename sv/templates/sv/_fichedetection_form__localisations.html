<!-- Liste des localisations -->
<template x-for="(localisation, index) in localisations" :key="localisation.id">
	<div class="localisation-initiale">
		<div class="lieu-header">
			<p x-text="localisation.nomLocalisation" class="lieu-nom"></p>
			<ul class="fr-btns-group fr-btns-group--sm fr-btns-group--inline-reverse fr-btns-group--inline-lg">
				<li>
					<button 
						class="localisation-edit-btn fr-btn fr-btn--secondary fr-icon-edit-fill" 
						title="Modifier la localisation"
						@click="fillLocalisationEditForm(localisation.id)" 
						data-fr-opened="false" 
						aria-controls="modal-add-edit-localisation"
						:aria-describedby="'tooltip-edit-localisation-' + localisation.id">
					</button>
					<span 
						class="fr-tooltip fr-placement" 
						:id="'tooltip-edit-localisation-' + localisation.id" 
						role="tooltip" 
						aria-hidden="true">
						Modifier la localisation
					</span>
				</li>
				<li>
					<button 
						class="localisation-delete-btn fr-btn fr-btn--secondary fr-icon-delete-fill" 
						title="Supprimer la localisation"
						@click="canDeleteLocalisation(localisation.id)"
						:aria-describedby="'tooltip-delete-localisation-' + localisation.id">
					</button>
					<span 
						class="fr-tooltip fr-placement" 
						:id="'tooltip-delete-localisation-' + localisation.id" 
						role="tooltip" 
						aria-hidden="true">
						Supprimer la localisation
					</span>
				</li>
			</ul>
		</div>
		<p class="lieu-commune" x-text="localisation.commune"></p>
	</div>
</template>

<!-- Modal ajout/modif localisation -->
<dialog aria-labelledby="modal-add-edit-localisation-title" id="modal-add-edit-localisation" class="fr-modal" role="dialog">
	<div class="fr-container fr-container--fluid fr-container-md">
		<div class="fr-grid-row fr-grid-row--center">
			<div class="fr-col-12 fr-col-md-8 fr-col-lg-6">
				<div class="fr-modal__body">
					<div class="fr-modal__header">
						<button class="fr-btn--close fr-btn" aria-controls="modal-add-edit-localisation">Fermer</button>
					</div>
					<div class="fr-modal__content">
						<h1 id="modal-add-edit-localisation-title" 
							class="fr-modal__title"
							x-text="(localisationIdToEdit === null ? 'Ajouter une' : 'Modifier la') + ' localisation'"></h1>
						<form x-ref="localisationForm" @submit.prevent="addOrEditLocalisation(localisationIdToEdit)" id="localisation-form">
							<p>
								<label class="fr-label" for="nom-localisation">Nom de la localisation</label>
								<input x-model="localisationForm.nomLocalisation" type="text" id="nom-localisation" required class="fr-input">
							</p>
							<p>
								<label class="fr-label" for="adresse-lieu-dit">Adresse ou lieu-dit</label>
								<input x-model="localisationForm.adresseLieuDit" type="text" id="adresse-lieu-dit" class="fr-input">
							</p>
							<p>
								<label class="fr-label" for="commune">Commune</label>
								<input x-model="localisationForm.commune" type="text" id="commune" class="fr-input">
							</p>
							<p>
								<label class="fr-label" for="code-insee">Code INSEE</label>
								<input x-model="localisationForm.codeINSEE" type="number" min="1001" max="99999" id="code-insee" class="fr-input" >
							</p>
							<p>
								<label class="fr-label" for="departement">Département</label>
								<select x-model="localisationForm.departementId" class="fr-select">
									<option value="">----</option>
									<template x-for="departement in departements" :key="departement.id">
										<option :value="departement.id" x-text="departement.nom + ' (' + departement.numero + ')'"></option>
									</template>
								</select>
							</p>
							<p>
								<label class="fr-label" for="coordonnees-gps-lambert-93-latitude">Coordonnées GPS (Lambert 93)</label>
								<input x-model="localisationForm.coordGPSLambert93Latitude" style="flex: 0.55; margin-right: 0.5rem;" type="number" step="1" min="6 000 000" max="7 200 000" id="coordonnees-gps-lambert-93-latitude" class="fr-input" placeholder="Latitude">
								<input x-model="localisationForm.coordGPSLambert93Longitude" style="flex: 0.55; margin-top: .5rem;" type="number" step="1" min="200 000" max="1 200 000" id="coordonnees-gps-lambert-93-longitude" class="fr-input" placeholder="Longitude">
							</p>
							<p>
								<label class="fr-label" for="coordonnees-gps-wgs84-latitude">Coordonnées GPS (WGS84)</label>
								<input x-model="localisationForm.coordGPSWGS84Latitude" style="flex: 0.55; margin-right: 0.5rem;" type="number" step="0.000001" min="-90" max="90" id="coordonnees-gps-wgs84-latitude" class="fr-input" placeholder="Latitude">
								<input x-model="localisationForm.coordGPSWGS84Longitude" style="flex: 0.55; margin-top: .5rem;" type="number" step="0.000001" min="-180" max="180" id="coordonnees-gps-wgs84-longitude" class="fr-input" placeholder="Longitude">
							</p>
						</form>
					</div>
					<div class="fr-modal__footer">
						<div class="fr-btns-group fr-btns-group--left fr-btns-group--inline-lg">
							<button @click="addOrEditLocalisation(localisationIdToEdit)" type="submit" x-text="localisationIdToEdit === null ? 'Enregistrer' : 'Enregistrer les modifications'" class="fr-btn"></button>
							<button class="fr-btn fr-btn--secondary" aria-controls="modal-add-edit-localisation">Annuler</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</dialog>

<!-- https://github.com/GouvernementFR/dsfr/issues/728 -->
<button style="display: none;" data-fr-opened="false" aria-controls="fr-modal-cant-delete-localisation"></button>
<!-- Modal confirmation suppression localisation -->
<dialog aria-labelledby="fr-modal-cant-delete-localisation-title" id="fr-modal-cant-delete-localisation" class="fr-modal" role="dialog">
	<div class="fr-container fr-container--fluid fr-container-md">
		<div class="fr-grid-row fr-grid-row--center">
			<div class="fr-col-12 fr-col-md-8 fr-col-lg-6">
				<div class="fr-modal__body">
					<div class="fr-modal__header">
						<button class="fr-btn--close fr-btn" aria-controls="fr-modal-cant-delete-localisation">Fermer</button>
					</div>
					<div class="fr-modal__content">
						<h1 id="fr-modal-cant-delete-localisation-title" class="fr-modal__title">Supprimer</h1>
						<p>Souhaitez-vous réellement supprimer la localisation ?</p>
						<div class="fr-btns-group fr-btns-group--left fr-btns-group--inline-lg">
							<button class="fr-btn" @click="deleteLocalisation(localisationIdToDelete)">Supprimer</button>
							<button class="fr-btn fr-btn--secondary" aria-controls="fr-modal-cant-delete-localisation">Annuler</button>
						</div>	
					</div>
				</div>
			</div>
		</div>
	</div>
</dialog>

<!-- https://github.com/GouvernementFR/dsfr/issues/728 -->
<button style="display: none;" data-fr-opened="false" aria-controls="fr-modal-suppression-localisation"></button>
<!-- Modal suppression localisation impossible -->
<dialog aria-labelledby="fr-modal-suppression-localisation-title" id="fr-modal-suppression-localisation" class="fr-modal" role="dialog">
	<div class="fr-container fr-container--fluid fr-container-md">
		<div class="fr-grid-row fr-grid-row--center">
			<div class="fr-col-12 fr-col-md-8 fr-col-lg-6">
				<div class="fr-modal__body">
					<div class="fr-modal__header">
						<button class="fr-btn--close fr-btn" aria-controls="fr-modal-suppression-localisation">Fermer</button>
					</div>
					<div class="fr-modal__content">
						<h1 id="fr-modal-suppression-localisation-title" class="fr-modal__title">
							Suppression de la localisation impossible
						</h1>
						<p>Cette localisation est liée à un ou plusieurs prélèvements. <br>
							Supprimez d'abord le(s) prélèvement(s) lié(s).
						</p>
					</div>
				</div>
			</div>
		</div>
	</div>
</dialog>

