<!-- Liste des prélèvements -->
<template x-for="prelevement in prelevements" :key="prelevement.id">
	<div class="prelevement">
		<div class="prelevement-header">
			<p class="prelevement-nom" x-text="getStructurePreleveurNameFromId(prelevement.structurePreleveurId)"></p>
			<ul class="fr-btns-group fr-btns-group--sm fr-btns-group--inline-reverse fr-btns-group--inline-lg">
				<button 
					class="prelevement-edit-btn fr-btn fr-btn--secondary fr-icon-edit-fill" 
					@click="fillPrelevementEditForm(prelevement.id)" 
					data-fr-opened="false" 
					aria-controls="modal-add-edit-prelevement"
					:aria-describedby="'tooltip-edit-prelevement-' + prelevement.id">
				</button>
				<span 
					class="fr-tooltip fr-placement" 
					:id="'tooltip-edit-prelevement-' + prelevement.id" 
					role="tooltip" 
					aria-hidden="true">
					Modifier le prélèvement
				</span>
				<button 
					class="prelevement-delete-btn fr-btn fr-btn--secondary fr-icon-delete-fill" 
					@click="showDeletePrelevementConfirmationModal(prelevement.id)"
					:aria-describedby="'tooltip-delete-prelevement-' + prelevement.id">
					Supprimer
				</button>
				<span 
					class="fr-tooltip fr-placement" 
					:id="'tooltip-delete-prelevement-' + prelevement.id" 
					role="tooltip"
					aria-hidden="true">
					Supprimer le prélèvement
				</span>
			</ul>
		</div>
		<p class="site-inspection" x-text="getSiteInspectionNameFromId(prelevement.siteInspectionId)"></p>
		<p class="date-prelevement" x-text="getDatePrelevementFormated(prelevement.datePrelevement)"></p>
		<p class="prelevement-type" x-bind:class="{'fr-icon-check-line': prelevement.isPrelevementOfficiel}" x-text="' Prélèvement ' + (prelevement.isPrelevementOfficiel ? 'officiel' : 'non officiel')"></p>
	</div>
</template>


<!-- Modal ajout/modif prélèvement -->
<dialog aria-labelledby="modal-add-edit-prelevement-title" id="modal-add-edit-prelevement" class="fr-modal" role="dialog">
	<div class="fr-container fr-container--fluid fr-container-md">
		<div class="fr-grid-row fr-grid-row--center">
			<div class="fr-col-12 fr-col-md-8 fr-col-lg-6">
				<div class="fr-modal__body">
					<div class="fr-modal__header">
						<button class="fr-btn--close fr-btn" aria-controls="modal-add-edit-prelevement">Fermer</button>
					</div>
					<div class="fr-modal__content">
						<h1 id="modal-add-edit-prelevement-title" 
							class="fr-modal__title" 
							x-text="(prelevementIdToEdit === null ? 'Ajouter' : 'Modifier') + ' un prelevement'"></h1>
						<form id="prelevement-form" x-ref="formPrelevement" @submit.prevent="addOrEditPrelevement(prelevementIdToEdit)">
							<div id="localisation" class="fr-select-group">
								<label class="fr-label">Localisation</label>
								<select class="fr-select" x-model="formPrelevement.localisationId">
									<template x-for="localisation in localisations" :key="localisation.id">
										<option :value="localisation.id" x-text="localisation.nomLocalisation"></option>
									</template>
								</select>
							</div>
							<div id="structure" class="fr-select-group">
								<label class="fr-label">Structure</label>
								<select x-model="formPrelevement.structurePreleveurId" class="fr-select" required>
									<option value="">----</option>
									<template x-for="structure in structuresPreleveurs" :key="structure.id">
										<option :value="structure.id" x-text="structure.nom"></option>
									</template>
								</select>
							</div>
							<p id="numero-echantillon">
								<label class="fr-label">N° d'échantillon</label>
								<input x-model="formPrelevement.numeroEchantillon" type="text" class="fr-input">
							</p>
							<p id="date-prelevement">
								<label class="fr-label">Date prélèvement</label>
								<input x-model="formPrelevement.datePrelevement" type="date" class="fr-input">
							</p>
							<p id="site-inspection">
								<label class="fr-label">Site d'inspection</label>
								<select x-model="formPrelevement.siteInspectionId" class="fr-select">
									<option value="">----</option>
									<template x-for="site in sitesInspections" :key="site.id">
										<option :value="site.id" x-text="site.nom"></option>
									</template>
								</select>
							</p>
							<p id="matrice-prelevee">
								<label class="fr-label">Matrice prélevée</label>
								<select x-model="formPrelevement.matricePreleveeId" class="fr-select">
									<option value="">----</option>
									<template x-for="matrice in matricesPrelevees" :key="matrice.id">
										<option :value="matrice.id" x-text="matrice.libelle"></option>
									</template>
								</select>
							</p>
							<p id="espece-echantillon">
								<label class="fr-label">Espèce de l'echantillon</label>
								<select x-model="formPrelevement.especeEchantillonId" class="fr-select">
									<option value="">----</option>
									<template x-for="espece in especesEchantillon" :key="espece.id">
										<option :value="espece.id" x-text="espece.libelle"></option>
									</template>
								</select>
							</p>
							<p>
								<div class="fr-checkbox-group">
									<input x-model="formPrelevement.isPrelevementOfficiel" name="is-prelevement-officiel" id="is-prelevement-officiel" type="checkbox" aria-describedby="is-prelevement-officiel-messages">
									<label class="fr-label" for="is-prelevement-officiel">Prélèvement officiel</label>
								</div>
							</p>
							<div x-show="formPrelevement.isPrelevementOfficiel">
								<p id="numero-phytopass">
									<label class="fr-label">N° Phytopass</label>
									<input x-model="formPrelevement.numeroPhytopass" type="text" class="fr-input">
								</p>
								<p id="laboratoire-agree">
									<label class="fr-label">Laboratoire agrée</label>
									<select x-model="formPrelevement.laboratoireAgreeId" class="fr-select">
										<option value="">----</option>
										<template x-for="laboratoire_agree in laboratoiresAgrees" :key="laboratoire_agree.id">
											<option :value="laboratoire_agree.id" x-text="laboratoire_agree.nom"></option>
										</template>
									</select>
								</p>
								<p id="laboratoire-confirmation">
									<label class="fr-label">Laboratoire de confirmation</label>
									<select x-model="formPrelevement.laboratoireConfirmationOfficielleId" class="fr-select">
										<option value="">----</option>
										<template x-for="laboratoire_confirmation_officielle in laboratoiresConfirmationOfficielle" :key="laboratoire_confirmation_officielle.id">
											<option :value="laboratoire_confirmation_officielle.id" x-text="laboratoire_confirmation_officielle.nom"></option>
										</template>
									</select>
								</p>
							</div>
						</form>
					</div>
					<div class="fr-modal__footer">
						<div class="fr-btns-group fr-btns-group--left fr-btns-group--inline-lg">
							<button class="fr-btn" @click="addOrEditPrelevement(prelevementIdToEdit)" type="submit" x-text="prelevementIdToEdit === null ? 'Ajouter' : 'Modifier'"></button>
							<button class="fr-btn fr-btn--secondary" aria-controls="modal-add-edit-prelevement">Annuler</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</dialog>

<!-- https://github.com/GouvernementFR/dsfr/issues/728 -->
<button style="display: none;" data-fr-opened="false" aria-controls="modal-delete-prelevement-confirmation"></button>
<!-- Modal confirmation suppression prelevement -->
<dialog aria-labelledby="modal-delete-prelevement-confirmation-title" id="modal-delete-prelevement-confirmation" class="fr-modal" role="dialog">
	<div class="fr-container fr-container--fluid fr-container-md">
		<div class="fr-grid-row fr-grid-row--center">
			<div class="fr-col-12 fr-col-md-8 fr-col-lg-6">
				<div class="fr-modal__body">
					<div class="fr-modal__header">
						<button class="fr-btn--close fr-btn" aria-controls="modal-delete-prelevement-confirmation">Fermer</button>
					</div>
					<div class="fr-modal__content">
						<h1 id="modal-delete-prelevement-confirmation-title" class="fr-modal__title">Supprimer</h1>
						<p>Souhaitez-vous réellement supprimer le prelevement ?</p>
						<div class="fr-btns-group fr-btns-group--left fr-btns-group--inline-lg">
							<button class="fr-btn" @click="deletePrelevement(prelevementIdToDelete)">Supprimer</button>
							<button class="fr-btn fr-btn--secondary" aria-controls="modal-delete-prelevement-confirmation">Annuler</button>
						</div>	
					</div>
				</div>
			</div>
		</div>
	</div>
</dialog>